{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "includeCoAuthoredBy": false,
  "env": {
    "INSIDE_CLAUDE_CODE": "1"
  },
  "permissions": {
    "allow": [
      "Read",
      "Edit",
      "Write",
      "Glob",
      "Grep",
      "WebSearch",
      "WebFetch",
      "NotebookEdit",
      "TodoRead",
      "TodoWrite",
      "AskFollowup",
      "Skill(*)",
      "Task(*)",
      "mcp__*",

      "Bash"
    ],
    "deny": [
      "Bash(git push --force:*)",
      "Bash(git push -f:*)",
      "Bash(git push origin --force:*)",
      "Bash(git push origin -f:*)",
      "Bash(git reset --hard:*)",
      "Bash(git clean -fd:*)",
      "Bash(git clean -fdx:*)",
      "Bash(git checkout .:*)",
      "Bash(git restore .:*)",
      "Bash(rm -rf /:*)",
      "Bash(rm -rf /*:*)",
      "Bash(rm -rf ~:*)",
      "Bash(rm -rf .:*)",
      "Bash(rm -rf ..:*)",
      "Bash(rm -rf node_modules:*)",
      "Bash(sudo:*)",
      "Bash(su -:*)",
      "Bash(chmod 777:*)",
      "Bash(chmod -R 777:*)",
      "Bash(chown -R:*)",
      "Bash(> /dev/sda:*)",
      "Bash(> /dev/nvme:*)",
      "Bash(mkfs:*)",
      "Bash(dd if=:*)",
      "Bash(eval:*)",
      "Bash(curl | bash:*)",
      "Bash(wget | bash:*)",
      "Bash(curl | sh:*)",
      "Bash(wget | sh:*)",
      "Bash(shutdown:*)",
      "Bash(reboot:*)",
      "Bash(halt:*)",
      "Bash(poweroff:*)"
    ]
  },
  "hooks": {
    "SessionStart": [
      {
        "description": "Afficher les informations du projet au demarrage",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"=== Claude Code Session ===\"; if [ -f VERSION ]; then echo \"Version socle: $(cat VERSION)\"; fi; if [ -d .claude/commands ]; then echo \"Commandes: $(find .claude/commands -name \"*.md\" -type f 2>/dev/null | wc -l | tr -d \" \")\"; fi; if [ -d .claude/agents ]; then echo \"Agents: $(find .claude/agents -name \"*.md\" -type f 2>/dev/null | wc -l | tr -d \" \")\"; fi; echo \"===========================\"'",
            "timeout": 5000
          }
        ]
      },
      {
        "description": "Verifier que node_modules existe si package.json present",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if [ -f package.json ] && [ ! -d node_modules ]; then echo \"[ALERT] node_modules manquant. Executez: npm install\"; fi'",
            "timeout": 3000
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "description": "Empecher les modifications sur la branche main/master (desactiver avec ALLOW_MAIN_EDIT=1)",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if [ \"$ALLOW_MAIN_EDIT\" = \"1\" ]; then exit 0; fi; BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null); if [ \"$BRANCH\" = \"main\" ] || [ \"$BRANCH\" = \"master\" ]; then echo \"BLOQUE: Creez une branche feature avant de modifier des fichiers.\"; echo \"Conseil: git checkout -b feature/ma-feature\"; exit 1; fi'",
            "timeout": 5000,
            "onFailure": "block"
          }
        ]
      },
      {
        "description": "Detecter les secrets avec gitleaks avant ecriture",
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if command -v gitleaks >/dev/null 2>&1 && [ -f .gitleaks.toml ]; then RESULT=$(echo \"$TOOL_CONTENT\" | gitleaks detect --no-git --pipe --config .gitleaks.toml 2>&1); if [ $? -eq 1 ]; then echo \"BLOQUE: Secret detecte par gitleaks.\"; echo \"$RESULT\"; exit 1; fi; fi'",
            "timeout": 10000,
            "onFailure": "block"
          }
        ]
      },
      {
        "description": "Executer les tests avant un commit (desactiver avec SKIP_PRE_COMMIT_TESTS=1)",
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if [ \"$SKIP_PRE_COMMIT_TESTS\" = \"1\" ]; then exit 0; fi; if echo \"$TOOL_INPUT\" | grep -q \"git commit\"; then if [ -f package.json ] && grep -q \"\\\"test\\\"\" package.json; then echo \"Execution des tests avant commit...\"; npm test 2>&1 | tail -20; if [ ${PIPESTATUS[0]} -ne 0 ]; then echo \"BLOQUE: Tests en echec. Corrigez avant de commit.\"; exit 1; fi; fi; fi'",
            "timeout": 120000,
            "onFailure": "block"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "description": "Auto-format TypeScript/JavaScript apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.(ts|tsx|js|jsx|mjs|cjs)$\"; then if [ -f node_modules/.bin/prettier ]; then npx prettier --write \"$TOOL_FILE\" 2>/dev/null || true; elif command -v prettier >/dev/null 2>&1; then prettier --write \"$TOOL_FILE\" 2>/dev/null || true; fi; fi'",
            "timeout": 10000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Type-check TypeScript apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.(ts|tsx)$\"; then if [ -f tsconfig.json ] && [ -f node_modules/.bin/tsc ]; then npx tsc --noEmit 2>&1 | head -20 || true; fi; fi'",
            "timeout": 30000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "ESLint verification apres modification JS/TS",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.(ts|tsx|js|jsx)$\"; then if [ -f node_modules/.bin/eslint ]; then npx eslint \"$TOOL_FILE\" --max-warnings 0 2>&1 | head -20 || true; fi; fi'",
            "timeout": 15000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-format Python apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.py$\"; then if command -v ruff >/dev/null 2>&1; then ruff format \"$TOOL_FILE\" 2>/dev/null || true; ruff check --fix \"$TOOL_FILE\" 2>/dev/null || true; elif command -v black >/dev/null 2>&1; then black \"$TOOL_FILE\" 2>/dev/null || true; fi; fi'",
            "timeout": 10000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-format Lua apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.lua$\"; then if command -v stylua >/dev/null 2>&1; then stylua \"$TOOL_FILE\" 2>/dev/null || true; fi; fi'",
            "timeout": 10000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-format Go apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.go$\"; then if command -v gofmt >/dev/null 2>&1; then gofmt -w \"$TOOL_FILE\" 2>/dev/null || true; fi; fi'",
            "timeout": 10000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-format Rust apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.rs$\"; then if command -v rustfmt >/dev/null 2>&1; then rustfmt \"$TOOL_FILE\" 2>/dev/null || true; fi; fi'",
            "timeout": 10000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-format Dart/Flutter apres modification",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.dart$\"; then if command -v dart >/dev/null 2>&1; then dart format \"$TOOL_FILE\" 2>/dev/null || true; fi; fi'",
            "timeout": 10000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-install apres modification de package.json",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -q \"package.json$\"; then if [ -f bun.lockb ]; then bun install --silent 2>&1 | tail -3 || true; elif [ -f pnpm-lock.yaml ]; then pnpm install --silent 2>&1 | tail -3 || true; elif [ -f yarn.lock ]; then yarn install --silent 2>&1 | tail -3 || true; else npm install --silent 2>&1 | tail -3 || true; fi; fi'",
            "timeout": 60000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto-sync apres modification de pyproject.toml",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -q \"pyproject.toml$\"; then if command -v uv >/dev/null 2>&1 && [ -f uv.lock ]; then uv sync 2>&1 | tail -3 || true; elif command -v pip >/dev/null 2>&1; then pip install -e . 2>&1 | tail -3 || true; fi; fi'",
            "timeout": 60000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto pub get apres modification de pubspec.yaml",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -q \"pubspec.yaml$\"; then if command -v flutter >/dev/null 2>&1; then flutter pub get 2>&1 | tail -3 || true; elif command -v dart >/dev/null 2>&1; then dart pub get 2>&1 | tail -3 || true; fi; fi'",
            "timeout": 60000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto go mod tidy apres modification de go.mod",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -q \"go.mod$\"; then if command -v go >/dev/null 2>&1; then go mod tidy 2>&1 | tail -3 || true; fi; fi'",
            "timeout": 60000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Auto cargo check apres modification de Cargo.toml",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -q \"Cargo.toml$\"; then if command -v cargo >/dev/null 2>&1; then cargo check 2>&1 | tail -5 || true; fi; fi'",
            "timeout": 120000,
            "onFailure": "ignore"
          }
        ]
      },
      {
        "description": "Verifier couverture de tests apres modification de tests",
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$TOOL_FILE\" | grep -qE \"\\.(test|spec)\\.(ts|tsx|js|jsx)$\"; then if [ -f package.json ] && grep -q \"test:coverage\" package.json; then echo \"Verification couverture...\"; npm run test:coverage -- --silent 2>&1 | grep -E \"(All files|Statements|Branches|Functions|Lines)\" | head -5 || true; fi; fi'",
            "timeout": 60000,
            "onFailure": "ignore"
          }
        ]
      }
    ]
  }
}
